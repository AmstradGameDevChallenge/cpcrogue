                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 3.6.8 #9946 (Linux)
                              4 ;--------------------------------------------------------
                              5 	.module fov
                              6 	.optsdcc -mz80
                              7 	
                              8 ;--------------------------------------------------------
                              9 ; Public variables in this module
                             10 ;--------------------------------------------------------
                             11 	.globl _TraceLine
                             12 ;--------------------------------------------------------
                             13 ; special function registers
                             14 ;--------------------------------------------------------
                             15 ;--------------------------------------------------------
                             16 ; ram data
                             17 ;--------------------------------------------------------
                             18 	.area _DATA
                             19 ;--------------------------------------------------------
                             20 ; ram data
                             21 ;--------------------------------------------------------
                             22 	.area _INITIALIZED
                             23 ;--------------------------------------------------------
                             24 ; absolute external ram data
                             25 ;--------------------------------------------------------
                             26 	.area _DABS (ABS)
                             27 ;--------------------------------------------------------
                             28 ; global & static initialisations
                             29 ;--------------------------------------------------------
                             30 	.area _HOME
                             31 	.area _GSINIT
                             32 	.area _GSFINAL
                             33 	.area _GSINIT
                             34 ;--------------------------------------------------------
                             35 ; Home
                             36 ;--------------------------------------------------------
                             37 	.area _HOME
                             38 	.area _HOME
                             39 ;--------------------------------------------------------
                             40 ; code
                             41 ;--------------------------------------------------------
                             42 	.area _CODE
                             43 ;src/fov.c:5: void TraceLine (u8 x1, u8 y1, u8 x2, u8 y2) //, u8 *coords)
                             44 ;	---------------------------------
                             45 ; Function TraceLine
                             46 ; ---------------------------------
   0000                      47 _TraceLine::
   0000 DD E5         [15]   48 	push	ix
   0002 DD 21 00 00   [14]   49 	ld	ix,#0
   0006 DD 39         [15]   50 	add	ix,sp
   0008 F5            [11]   51 	push	af
   0009 F5            [11]   52 	push	af
                             53 ;src/fov.c:12: dx = x2-x1;
   000A DD 7E 06      [19]   54 	ld	a, 6 (ix)
   000D DD 96 04      [19]   55 	sub	a, 4 (ix)
   0010 5F            [ 4]   56 	ld	e, a
                             57 ;src/fov.c:13: dy = y2-y1;
   0011 DD 7E 07      [19]   58 	ld	a, 7 (ix)
   0014 DD 96 05      [19]   59 	sub	a, 5 (ix)
   0017 6F            [ 4]   60 	ld	l, a
                             61 ;src/fov.c:14: sx = sign (dx);
   0018 4B            [ 4]   62 	ld	c, e
                             63 ;src/fast_math.h:13: return value < 0 ? -1 : 1;
   0019 CB 79         [ 8]   64 	bit	7, c
   001B 28 04         [12]   65 	jr	Z,00117$
   001D 0E FF         [ 7]   66 	ld	c, #0xff
   001F 18 02         [12]   67 	jr	00118$
   0021                      68 00117$:
   0021 0E 01         [ 7]   69 	ld	c, #0x01
   0023                      70 00118$:
                             71 ;src/fov.c:14: sx = sign (dx);
                             72 ;src/fov.c:15: sy = sign (dy);
   0023 45            [ 4]   73 	ld	b, l
                             74 ;src/fast_math.h:13: return value < 0 ? -1 : 1;
   0024 CB 78         [ 8]   75 	bit	7, b
   0026 28 04         [12]   76 	jr	Z,00119$
   0028 3E FF         [ 7]   77 	ld	a, #0xff
   002A 18 02         [12]   78 	jr	00120$
   002C                      79 00119$:
   002C 3E 01         [ 7]   80 	ld	a, #0x01
   002E                      81 00120$:
                             82 ;src/fov.c:15: sy = sign (dy);
   002E DD 77 FD      [19]   83 	ld	-3 (ix), a
                             84 ;src/fov.c:16: dx = abs (dx);
   0031 43            [ 4]   85 	ld	b, e
                             86 ;src/fast_math.h:9: return value < 0 ? -value : value;
   0032 CB 78         [ 8]   87 	bit	7, b
   0034 28 03         [12]   88 	jr	Z,00121$
   0036 AF            [ 4]   89 	xor	a, a
   0037 93            [ 4]   90 	sub	a, e
   0038 5F            [ 4]   91 	ld	e, a
   0039                      92 00121$:
                             93 ;src/fov.c:16: dx = abs (dx);
                             94 ;src/fov.c:17: dy = abs (dy);
   0039 45            [ 4]   95 	ld	b, l
                             96 ;src/fast_math.h:9: return value < 0 ? -value : value;
   003A CB 78         [ 8]   97 	bit	7, b
   003C 28 03         [12]   98 	jr	Z,00123$
   003E AF            [ 4]   99 	xor	a, a
   003F 95            [ 4]  100 	sub	a, l
   0040 6F            [ 4]  101 	ld	l, a
   0041                     102 00123$:
                            103 ;src/fov.c:17: dy = abs (dy);
   0041 45            [ 4]  104 	ld	b, l
                            105 ;src/fov.c:18: error = dx-dy;
   0042 7B            [ 4]  106 	ld	a, e
   0043 95            [ 4]  107 	sub	a, l
   0044 57            [ 4]  108 	ld	d, a
                            109 ;src/fov.c:21: while(1) {
   0045                     110 00109$:
                            111 ;src/fov.c:26: if (x1==x2 && y1==y2) {
   0045 DD 7E 04      [19]  112 	ld	a, 4 (ix)
   0048 DD 96 06      [19]  113 	sub	a, 6 (ix)
   004B 20 08         [12]  114 	jr	NZ,00102$
   004D DD 7E 05      [19]  115 	ld	a, 5 (ix)
   0050 DD 96 07      [19]  116 	sub	a, 7 (ix)
   0053 28 52         [12]  117 	jr	Z,00115$
                            118 ;src/fov.c:28: break;
   0055                     119 00102$:
                            120 ;src/fov.c:31: error2 = error << 1;
   0055 7A            [ 4]  121 	ld	a, d
   0056 87            [ 4]  122 	add	a, a
   0057 DD 77 FC      [19]  123 	ld	-4 (ix), a
                            124 ;src/fov.c:32: if (error2 > -dx) {
   005A 6B            [ 4]  125 	ld	l, e
   005B 26 00         [ 7]  126 	ld	h, #0x00
   005D AF            [ 4]  127 	xor	a, a
   005E 95            [ 4]  128 	sub	a, l
   005F DD 77 FE      [19]  129 	ld	-2 (ix), a
   0062 3E 00         [ 7]  130 	ld	a, #0x00
   0064 9C            [ 4]  131 	sbc	a, h
   0065 DD 77 FF      [19]  132 	ld	-1 (ix), a
   0068 DD 6E FC      [19]  133 	ld	l, -4 (ix)
   006B DD 7E FC      [19]  134 	ld	a, -4 (ix)
   006E 17            [ 4]  135 	rla
   006F 9F            [ 4]  136 	sbc	a, a
   0070 67            [ 4]  137 	ld	h, a
   0071 DD 7E FE      [19]  138 	ld	a, -2 (ix)
   0074 95            [ 4]  139 	sub	a, l
   0075 DD 7E FF      [19]  140 	ld	a, -1 (ix)
   0078 9C            [ 4]  141 	sbc	a, h
   0079 E2r7Er00      [10]  142 	jp	PO, 00160$
   007C EE 80         [ 7]  143 	xor	a, #0x80
   007E                     144 00160$:
   007E F2r8Cr00      [10]  145 	jp	P, 00105$
                            146 ;src/fov.c:33: error -= dy;
   0081 68            [ 4]  147 	ld	l, b
   0082 7A            [ 4]  148 	ld	a, d
   0083 95            [ 4]  149 	sub	a, l
   0084 57            [ 4]  150 	ld	d, a
                            151 ;src/fov.c:34: x1 += sx;
   0085 DD 6E 04      [19]  152 	ld	l, 4 (ix)
   0088 09            [11]  153 	add	hl, bc
   0089 DD 75 04      [19]  154 	ld	4 (ix), l
   008C                     155 00105$:
                            156 ;src/fov.c:36: if (error2 < (i8)dx) {
   008C 6B            [ 4]  157 	ld	l, e
   008D DD 7E FC      [19]  158 	ld	a, -4 (ix)
   0090 95            [ 4]  159 	sub	a, l
   0091 E2r96r00      [10]  160 	jp	PO, 00161$
   0094 EE 80         [ 7]  161 	xor	a, #0x80
   0096                     162 00161$:
   0096 F2r45r00      [10]  163 	jp	P, 00109$
                            164 ;src/fov.c:37: error += dx;
   0099 7A            [ 4]  165 	ld	a, d
   009A 85            [ 4]  166 	add	a, l
   009B 57            [ 4]  167 	ld	d, a
                            168 ;src/fov.c:38: y1 += sy;
   009C DD 7E 05      [19]  169 	ld	a, 5 (ix)
   009F DD 86 FD      [19]  170 	add	a, -3 (ix)
   00A2 DD 77 05      [19]  171 	ld	5 (ix), a
   00A5 18 9E         [12]  172 	jr	00109$
   00A7                     173 00115$:
   00A7 DD F9         [10]  174 	ld	sp, ix
   00A9 DD E1         [14]  175 	pop	ix
   00AB C9            [10]  176 	ret
                            177 	.area _CODE
                            178 	.area _INITIALIZER
                            179 	.area _CABS (ABS)
