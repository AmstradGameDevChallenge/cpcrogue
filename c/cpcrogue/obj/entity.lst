                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 3.6.8 #9946 (Linux)
                              4 ;--------------------------------------------------------
                              5 	.module entity
                              6 	.optsdcc -mz80
                              7 	
                              8 ;--------------------------------------------------------
                              9 ; Public variables in this module
                             10 ;--------------------------------------------------------
                             11 	.globl _EntityTakeDamage
                             12 	.globl _EntityCalculateDamage
                             13 	.globl _PrintU8
                             14 	.globl _PrintAt
                             15 	.globl _pen
                             16 	.globl _locate
                             17 	.globl _cpct_getRandom_mxor_u8
                             18 	.globl _putchar
                             19 	.globl _EntityInit
                             20 	.globl _EntityDraw
                             21 	.globl _EntityMove
                             22 	.globl _EntityAttack
                             23 	.globl _GetBlockingEntity
                             24 	.globl _EntityDrawEntities
                             25 ;--------------------------------------------------------
                             26 ; special function registers
                             27 ;--------------------------------------------------------
                             28 ;--------------------------------------------------------
                             29 ; ram data
                             30 ;--------------------------------------------------------
                             31 	.area _DATA
                             32 ;--------------------------------------------------------
                             33 ; ram data
                             34 ;--------------------------------------------------------
                             35 	.area _INITIALIZED
                             36 ;--------------------------------------------------------
                             37 ; absolute external ram data
                             38 ;--------------------------------------------------------
                             39 	.area _DABS (ABS)
                             40 ;--------------------------------------------------------
                             41 ; global & static initialisations
                             42 ;--------------------------------------------------------
                             43 	.area _HOME
                             44 	.area _GSINIT
                             45 	.area _GSFINAL
                             46 	.area _GSINIT
                             47 ;--------------------------------------------------------
                             48 ; Home
                             49 ;--------------------------------------------------------
                             50 	.area _HOME
                             51 	.area _HOME
                             52 ;--------------------------------------------------------
                             53 ; code
                             54 ;--------------------------------------------------------
                             55 	.area _CODE
                             56 ;src/entity.c:12: void EntityInit (TEntity *e, u8 x, u8 y, u8 spr, u8 color, u8 name[],
                             57 ;	---------------------------------
                             58 ; Function EntityInit
                             59 ; ---------------------------------
   0000                      60 _EntityInit::
   0000 DD E5         [15]   61 	push	ix
   0002 DD 21 00 00   [14]   62 	ld	ix,#0
   0006 DD 39         [15]   63 	add	ix,sp
   0008 F5            [11]   64 	push	af
                             65 ;src/entity.c:15: e->x = e->px = x;  // current posX
   0009 DD 4E 04      [19]   66 	ld	c,4 (ix)
   000C DD 46 05      [19]   67 	ld	b,5 (ix)
   000F 59            [ 4]   68 	ld	e, c
   0010 50            [ 4]   69 	ld	d, b
   0011 13            [ 6]   70 	inc	de
   0012 13            [ 6]   71 	inc	de
   0013 DD 7E 06      [19]   72 	ld	a, 6 (ix)
   0016 12            [ 7]   73 	ld	(de), a
   0017 DD 7E 06      [19]   74 	ld	a, 6 (ix)
   001A 02            [ 7]   75 	ld	(bc), a
                             76 ;src/entity.c:16: e->y = e->py = y;  // current posY
   001B 59            [ 4]   77 	ld	e, c
   001C 50            [ 4]   78 	ld	d, b
   001D 13            [ 6]   79 	inc	de
   001E 69            [ 4]   80 	ld	l, c
   001F 60            [ 4]   81 	ld	h, b
   0020 23            [ 6]   82 	inc	hl
   0021 23            [ 6]   83 	inc	hl
   0022 23            [ 6]   84 	inc	hl
   0023 DD 7E 07      [19]   85 	ld	a, 7 (ix)
   0026 77            [ 7]   86 	ld	(hl), a
   0027 DD 7E 07      [19]   87 	ld	a, 7 (ix)
   002A 12            [ 7]   88 	ld	(de), a
                             89 ;src/entity.c:17: e->spr =spr;
   002B 21 04 00      [10]   90 	ld	hl, #0x0004
   002E 09            [11]   91 	add	hl, bc
   002F DD 7E 08      [19]   92 	ld	a, 8 (ix)
   0032 77            [ 7]   93 	ld	(hl), a
                             94 ;src/entity.c:18: e->color = color;
   0033 21 05 00      [10]   95 	ld	hl, #0x0005
   0036 09            [11]   96 	add	hl, bc
   0037 DD 7E 09      [19]   97 	ld	a, 9 (ix)
   003A 77            [ 7]   98 	ld	(hl), a
                             99 ;src/entity.c:19: strcpy (e->name, name);
   003B 21 06 00      [10]  100 	ld	hl, #0x0006
   003E 09            [11]  101 	add	hl,bc
   003F EB            [ 4]  102 	ex	de,hl
   0040 C5            [11]  103 	push	bc
   0041 DD 6E 0A      [19]  104 	ld	l,10 (ix)
   0044 DD 66 0B      [19]  105 	ld	h,11 (ix)
   0047 AF            [ 4]  106 	xor	a, a
   0048                     107 00103$:
   0048 BE            [ 7]  108 	cp	a, (hl)
   0049 ED A0         [16]  109 	ldi
   004B 20 FB         [12]  110 	jr	NZ, 00103$
   004D C1            [10]  111 	pop	bc
                            112 ;src/entity.c:20: e->blocks = blocks;
   004E 21 15 00      [10]  113 	ld	hl, #0x0015
   0051 09            [11]  114 	add	hl, bc
   0052 DD 7E 0C      [19]  115 	ld	a, 12 (ix)
   0055 77            [ 7]  116 	ld	(hl), a
                            117 ;src/entity.c:22: e->max_hp = hp;
   0056 21 16 00      [10]  118 	ld	hl, #0x0016
   0059 09            [11]  119 	add	hl, bc
   005A DD 7E 0D      [19]  120 	ld	a, 13 (ix)
   005D 77            [ 7]  121 	ld	(hl), a
   005E 23            [ 6]  122 	inc	hl
   005F DD 7E 0E      [19]  123 	ld	a, 14 (ix)
   0062 77            [ 7]  124 	ld	(hl), a
                            125 ;src/entity.c:23: e->hp = hp;
   0063 21 18 00      [10]  126 	ld	hl, #0x0018
   0066 09            [11]  127 	add	hl, bc
   0067 DD 7E 0D      [19]  128 	ld	a, 13 (ix)
   006A 77            [ 7]  129 	ld	(hl), a
   006B 23            [ 6]  130 	inc	hl
   006C DD 7E 0E      [19]  131 	ld	a, 14 (ix)
   006F 77            [ 7]  132 	ld	(hl), a
                            133 ;src/entity.c:24: e->str = str;
   0070 21 1A 00      [10]  134 	ld	hl, #0x001a
   0073 09            [11]  135 	add	hl, bc
   0074 DD 7E 0F      [19]  136 	ld	a, 15 (ix)
   0077 77            [ 7]  137 	ld	(hl), a
                            138 ;src/entity.c:25: e->des = destr;
   0078 21 1B 00      [10]  139 	ld	hl, #0x001b
   007B 09            [11]  140 	add	hl, bc
   007C DD 7E 10      [19]  141 	ld	a, 16 (ix)
   007F 77            [ 7]  142 	ld	(hl), a
                            143 ;src/entity.c:26: e->ref = refl;
   0080 21 1C 00      [10]  144 	ld	hl, #0x001c
   0083 09            [11]  145 	add	hl, bc
   0084 DD 7E 11      [19]  146 	ld	a, 17 (ix)
   0087 77            [ 7]  147 	ld	(hl), a
                            148 ;src/entity.c:28: e->atk = (str  + destr)>>1;
   0088 21 1D 00      [10]  149 	ld	hl, #0x001d
   008B 09            [11]  150 	add	hl, bc
   008C DD 5E 0F      [19]  151 	ld	e, 15 (ix)
   008F 16 00         [ 7]  152 	ld	d, #0x00
   0091 DD 7E 10      [19]  153 	ld	a, 16 (ix)
   0094 DD 77 FE      [19]  154 	ld	-2 (ix), a
   0097 DD 36 FF 00   [19]  155 	ld	-1 (ix), #0x00
   009B 7B            [ 4]  156 	ld	a, e
   009C DD 86 FE      [19]  157 	add	a, -2 (ix)
   009F 5F            [ 4]  158 	ld	e, a
   00A0 7A            [ 4]  159 	ld	a, d
   00A1 DD 8E FF      [19]  160 	adc	a, -1 (ix)
   00A4 57            [ 4]  161 	ld	d, a
   00A5 CB 2A         [ 8]  162 	sra	d
   00A7 CB 1B         [ 8]  163 	rr	e
   00A9 73            [ 7]  164 	ld	(hl), e
   00AA 23            [ 6]  165 	inc	hl
   00AB 72            [ 7]  166 	ld	(hl), d
                            167 ;src/entity.c:29: e->def = (destr + refl)>>1;
   00AC 21 1F 00      [10]  168 	ld	hl, #0x001f
   00AF 09            [11]  169 	add	hl, bc
   00B0 DD 4E 11      [19]  170 	ld	c, 17 (ix)
   00B3 06 00         [ 7]  171 	ld	b, #0x00
   00B5 DD 7E FE      [19]  172 	ld	a, -2 (ix)
   00B8 81            [ 4]  173 	add	a, c
   00B9 4F            [ 4]  174 	ld	c, a
   00BA DD 7E FF      [19]  175 	ld	a, -1 (ix)
   00BD 88            [ 4]  176 	adc	a, b
   00BE 47            [ 4]  177 	ld	b, a
   00BF CB 28         [ 8]  178 	sra	b
   00C1 CB 19         [ 8]  179 	rr	c
   00C3 71            [ 7]  180 	ld	(hl), c
   00C4 23            [ 6]  181 	inc	hl
   00C5 70            [ 7]  182 	ld	(hl), b
   00C6 DD F9         [10]  183 	ld	sp, ix
   00C8 DD E1         [14]  184 	pop	ix
   00CA C9            [10]  185 	ret
                            186 ;src/entity.c:34: void EntityDraw (struct TEntity *e, u8 erase)
                            187 ;	---------------------------------
                            188 ; Function EntityDraw
                            189 ; ---------------------------------
   00CB                     190 _EntityDraw::
   00CB DD E5         [15]  191 	push	ix
   00CD DD 21 00 00   [14]  192 	ld	ix,#0
   00D1 DD 39         [15]  193 	add	ix,sp
   00D3 3B            [ 6]  194 	dec	sp
                            195 ;src/entity.c:38: x = e->px;
   00D4 DD 4E 04      [19]  196 	ld	c,4 (ix)
   00D7 DD 46 05      [19]  197 	ld	b,5 (ix)
                            198 ;src/entity.c:37: if (erase) {
   00DA DD 7E 06      [19]  199 	ld	a, 6 (ix)
   00DD B7            [ 4]  200 	or	a, a
   00DE 28 13         [12]  201 	jr	Z,00102$
                            202 ;src/entity.c:38: x = e->px;
   00E0 69            [ 4]  203 	ld	l, c
   00E1 60            [ 4]  204 	ld	h, b
   00E2 23            [ 6]  205 	inc	hl
   00E3 23            [ 6]  206 	inc	hl
   00E4 5E            [ 7]  207 	ld	e, (hl)
                            208 ;src/entity.c:39: y = e->py;
   00E5 69            [ 4]  209 	ld	l, c
   00E6 60            [ 4]  210 	ld	h, b
   00E7 23            [ 6]  211 	inc	hl
   00E8 23            [ 6]  212 	inc	hl
   00E9 23            [ 6]  213 	inc	hl
   00EA 56            [ 7]  214 	ld	d, (hl)
                            215 ;src/entity.c:40: color = PEN_TILE;
   00EB DD 36 FF 03   [19]  216 	ld	-1 (ix), #0x03
                            217 ;src/entity.c:41: spr = SPR_FLOOR;
   00EF 0E 2E         [ 7]  218 	ld	c, #0x2e
   00F1 18 16         [12]  219 	jr	00103$
   00F3                     220 00102$:
                            221 ;src/entity.c:44: x = e->x;
   00F3 0A            [ 7]  222 	ld	a, (bc)
   00F4 5F            [ 4]  223 	ld	e, a
                            224 ;src/entity.c:45: y = e->y;
   00F5 69            [ 4]  225 	ld	l, c
   00F6 60            [ 4]  226 	ld	h, b
   00F7 23            [ 6]  227 	inc	hl
   00F8 56            [ 7]  228 	ld	d, (hl)
                            229 ;src/entity.c:46: color = e->color;
   00F9 C5            [11]  230 	push	bc
   00FA FD E1         [14]  231 	pop	iy
   00FC FD 7E 05      [19]  232 	ld	a, 5 (iy)
   00FF DD 77 FF      [19]  233 	ld	-1 (ix), a
                            234 ;src/entity.c:47: spr = e->spr;
   0102 69            [ 4]  235 	ld	l, c
   0103 60            [ 4]  236 	ld	h, b
   0104 01 04 00      [10]  237 	ld	bc, #0x0004
   0107 09            [11]  238 	add	hl, bc
   0108 4E            [ 7]  239 	ld	c, (hl)
   0109                     240 00103$:
                            241 ;src/entity.c:49: pen (color);
   0109 C5            [11]  242 	push	bc
   010A D5            [11]  243 	push	de
   010B DD 7E FF      [19]  244 	ld	a, -1 (ix)
   010E F5            [11]  245 	push	af
   010F 33            [ 6]  246 	inc	sp
   0110 CDr00r00      [17]  247 	call	_pen
   0113 33            [ 6]  248 	inc	sp
   0114 D1            [10]  249 	pop	de
   0115 C1            [10]  250 	pop	bc
                            251 ;src/entity.c:50: locate (PLAY_X+x, PLAY_Y+y);
   0116 14            [ 4]  252 	inc	d
   0117 14            [ 4]  253 	inc	d
   0118 43            [ 4]  254 	ld	b, e
   0119 04            [ 4]  255 	inc	b
   011A 04            [ 4]  256 	inc	b
   011B C5            [11]  257 	push	bc
   011C 58            [ 4]  258 	ld	e, b
   011D D5            [11]  259 	push	de
   011E CDr00r00      [17]  260 	call	_locate
   0121 F1            [10]  261 	pop	af
   0122 C1            [10]  262 	pop	bc
                            263 ;src/entity.c:51: putchar (spr);
   0123 06 00         [ 7]  264 	ld	b, #0x00
   0125 C5            [11]  265 	push	bc
   0126 CDr00r00      [17]  266 	call	_putchar
   0129 F1            [10]  267 	pop	af
   012A 33            [ 6]  268 	inc	sp
   012B DD E1         [14]  269 	pop	ix
   012D C9            [10]  270 	ret
                            271 ;src/entity.c:56: void EntityMove (TEntity *e, i8 dx, i8 dy)
                            272 ;	---------------------------------
                            273 ; Function EntityMove
                            274 ; ---------------------------------
   012E                     275 _EntityMove::
   012E DD E5         [15]  276 	push	ix
   0130 DD 21 00 00   [14]  277 	ld	ix,#0
   0134 DD 39         [15]  278 	add	ix,sp
                            279 ;src/entity.c:58: e->px = e->x;     // Save old positions
   0136 DD 5E 04      [19]  280 	ld	e,4 (ix)
   0139 DD 56 05      [19]  281 	ld	d,5 (ix)
   013C 4B            [ 4]  282 	ld	c, e
   013D 42            [ 4]  283 	ld	b, d
   013E 03            [ 6]  284 	inc	bc
   013F 03            [ 6]  285 	inc	bc
   0140 1A            [ 7]  286 	ld	a, (de)
   0141 02            [ 7]  287 	ld	(bc), a
                            288 ;src/entity.c:59: e->py = e->y;
   0142 D5            [11]  289 	push	de
   0143 FD E1         [14]  290 	pop	iy
   0145 FD 23         [10]  291 	inc	iy
   0147 FD 23         [10]  292 	inc	iy
   0149 FD 23         [10]  293 	inc	iy
   014B 4B            [ 4]  294 	ld	c, e
   014C 42            [ 4]  295 	ld	b, d
   014D 03            [ 6]  296 	inc	bc
   014E 0A            [ 7]  297 	ld	a, (bc)
   014F FD 77 00      [19]  298 	ld	0 (iy), a
                            299 ;src/entity.c:60: e->x  = e->x+dx;   // Update to new position
   0152 1A            [ 7]  300 	ld	a, (de)
   0153 DD 86 06      [19]  301 	add	a, 6 (ix)
   0156 12            [ 7]  302 	ld	(de), a
                            303 ;src/entity.c:61: e->y  = e->y+dy;
   0157 0A            [ 7]  304 	ld	a, (bc)
   0158 DD 86 07      [19]  305 	add	a, 7 (ix)
   015B 02            [ 7]  306 	ld	(bc), a
   015C DD E1         [14]  307 	pop	ix
   015E C9            [10]  308 	ret
                            309 ;src/entity.c:66: u8 EntityCalculateDamage (TEntity *e)
                            310 ;	---------------------------------
                            311 ; Function EntityCalculateDamage
                            312 ; ---------------------------------
   015F                     313 _EntityCalculateDamage::
                            314 ;src/entity.c:68: u8 dmg = e->atk >> 2;
   015F C1            [10]  315 	pop	bc
   0160 E1            [10]  316 	pop	hl
   0161 E5            [11]  317 	push	hl
   0162 C5            [11]  318 	push	bc
   0163 11 1D 00      [10]  319 	ld	de, #0x001d
   0166 19            [11]  320 	add	hl, de
   0167 4E            [ 7]  321 	ld	c, (hl)
   0168 23            [ 6]  322 	inc	hl
   0169 46            [ 7]  323 	ld	b, (hl)
   016A CB 38         [ 8]  324 	srl	b
   016C CB 19         [ 8]  325 	rr	c
   016E CB 38         [ 8]  326 	srl	b
   0170 CB 19         [ 8]  327 	rr	c
                            328 ;src/entity.c:69: u8 r = (cpct_rand() * 7/255) - 3;
   0172 C5            [11]  329 	push	bc
   0173 CDr00r00      [17]  330 	call	_cpct_getRandom_mxor_u8
   0176 C1            [10]  331 	pop	bc
   0177 5D            [ 4]  332 	ld	e,l
   0178 16 00         [ 7]  333 	ld	d,#0x00
   017A 6B            [ 4]  334 	ld	l, e
   017B 62            [ 4]  335 	ld	h, d
   017C 29            [11]  336 	add	hl, hl
   017D 19            [11]  337 	add	hl, de
   017E 29            [11]  338 	add	hl, hl
   017F 19            [11]  339 	add	hl, de
   0180 C5            [11]  340 	push	bc
   0181 11 FF 00      [10]  341 	ld	de, #0x00ff
   0184 D5            [11]  342 	push	de
   0185 E5            [11]  343 	push	hl
   0186 CDr00r00      [17]  344 	call	__divsint
   0189 F1            [10]  345 	pop	af
   018A F1            [10]  346 	pop	af
   018B C1            [10]  347 	pop	bc
   018C 7D            [ 4]  348 	ld	a, l
   018D C6 FD         [ 7]  349 	add	a, #0xfd
                            350 ;src/entity.c:70: dmg += r;
   018F 81            [ 4]  351 	add	a,c
                            352 ;src/entity.c:71: return (dmg < 127 ? dmg : dmg+3);
   0190 FE 7F         [ 7]  353 	cp	a, #0x7f
   0192 38 02         [12]  354 	jr	C,00104$
   0194 C6 03         [ 7]  355 	add	a, #0x03
   0196                     356 00104$:
   0196 6F            [ 4]  357 	ld	l, a
   0197 C9            [10]  358 	ret
                            359 ;src/entity.c:76: void EntityTakeDamage (TEntity *e, u8 dmg)
                            360 ;	---------------------------------
                            361 ; Function EntityTakeDamage
                            362 ; ---------------------------------
   0198                     363 _EntityTakeDamage::
   0198 DD E5         [15]  364 	push	ix
   019A DD 21 00 00   [14]  365 	ld	ix,#0
   019E DD 39         [15]  366 	add	ix,sp
   01A0 F5            [11]  367 	push	af
                            368 ;src/entity.c:78: e->hp -= dmg;
   01A1 DD 4E 04      [19]  369 	ld	c,4 (ix)
   01A4 DD 46 05      [19]  370 	ld	b,5 (ix)
   01A7 21 18 00      [10]  371 	ld	hl, #0x0018
   01AA 09            [11]  372 	add	hl, bc
   01AB E5            [11]  373 	push	hl
   01AC 7E            [ 7]  374 	ld	a, (hl)
   01AD DD 77 FE      [19]  375 	ld	-2 (ix), a
   01B0 23            [ 6]  376 	inc	hl
   01B1 7E            [ 7]  377 	ld	a, (hl)
   01B2 DD 77 FF      [19]  378 	ld	-1 (ix), a
   01B5 E1            [10]  379 	pop	hl
   01B6 DD 5E 06      [19]  380 	ld	e, 6 (ix)
   01B9 16 00         [ 7]  381 	ld	d, #0x00
   01BB DD 7E FE      [19]  382 	ld	a, -2 (ix)
   01BE 93            [ 4]  383 	sub	a, e
   01BF 5F            [ 4]  384 	ld	e, a
   01C0 DD 7E FF      [19]  385 	ld	a, -1 (ix)
   01C3 9A            [ 4]  386 	sbc	a, d
   01C4 57            [ 4]  387 	ld	d, a
   01C5 73            [ 7]  388 	ld	(hl), e
   01C6 23            [ 6]  389 	inc	hl
   01C7 72            [ 7]  390 	ld	(hl), d
                            391 ;src/entity.c:79: PrintAt (STATUS_X,STATUS_Y+1, e->name, PEN_BRIGHT);
   01C8 21 06 00      [10]  392 	ld	hl, #0x0006
   01CB 09            [11]  393 	add	hl, bc
   01CC 3E 02         [ 7]  394 	ld	a, #0x02
   01CE F5            [11]  395 	push	af
   01CF 33            [ 6]  396 	inc	sp
   01D0 E5            [11]  397 	push	hl
   01D1 21 02 16      [10]  398 	ld	hl, #0x1602
   01D4 E5            [11]  399 	push	hl
   01D5 CDr00r00      [17]  400 	call	_PrintAt
   01D8 F1            [10]  401 	pop	af
   01D9 F1            [10]  402 	pop	af
   01DA 33            [ 6]  403 	inc	sp
                            404 ;src/entity.c:80: PrintAt (STATUS_X+7,STATUS_Y+1, "takes     ", PEN_NORMAL);
   01DB 3E 03         [ 7]  405 	ld	a, #0x03
   01DD F5            [11]  406 	push	af
   01DE 33            [ 6]  407 	inc	sp
   01DF 21r11r02      [10]  408 	ld	hl, #___str_0
   01E2 E5            [11]  409 	push	hl
   01E3 21 09 16      [10]  410 	ld	hl, #0x1609
   01E6 E5            [11]  411 	push	hl
   01E7 CDr00r00      [17]  412 	call	_PrintAt
   01EA F1            [10]  413 	pop	af
                            414 ;src/entity.c:81: PrintU8 (dmg, STATUS_X+13,STATUS_Y+1, PEN_BRIGHT);
   01EB 33            [ 6]  415 	inc	sp
   01EC 21 16 02      [10]  416 	ld	hl,#0x0216
   01EF E3            [19]  417 	ex	(sp),hl
   01F0 3E 0F         [ 7]  418 	ld	a, #0x0f
   01F2 F5            [11]  419 	push	af
   01F3 33            [ 6]  420 	inc	sp
   01F4 DD 7E 06      [19]  421 	ld	a, 6 (ix)
   01F7 F5            [11]  422 	push	af
   01F8 33            [ 6]  423 	inc	sp
   01F9 CDr00r00      [17]  424 	call	_PrintU8
   01FC F1            [10]  425 	pop	af
                            426 ;src/entity.c:82: PrintAt (STATUS_X+16,STATUS_Y+1, "points of damage", PEN_NORMAL);
   01FD 26 03         [ 7]  427 	ld	h,#0x03
   01FF E3            [19]  428 	ex	(sp),hl
   0200 33            [ 6]  429 	inc	sp
   0201 21r1Cr02      [10]  430 	ld	hl, #___str_1
   0204 E5            [11]  431 	push	hl
   0205 21 12 16      [10]  432 	ld	hl, #0x1612
   0208 E5            [11]  433 	push	hl
   0209 CDr00r00      [17]  434 	call	_PrintAt
   020C DD F9         [10]  435 	ld	sp,ix
   020E DD E1         [14]  436 	pop	ix
   0210 C9            [10]  437 	ret
   0211                     438 ___str_0:
   0211 74 61 6B 65 73 20   439 	.ascii "takes     "
        20 20 20 20
   021B 00                  440 	.db 0x00
   021C                     441 ___str_1:
   021C 70 6F 69 6E 74 73   442 	.ascii "points of damage"
        20 6F 66 20 64 61
        6D 61 67 65
   022C 00                  443 	.db 0x00
                            444 ;src/entity.c:87: void EntityAttack (TEntity *e, TEntity *target)
                            445 ;	---------------------------------
                            446 ; Function EntityAttack
                            447 ; ---------------------------------
   022D                     448 _EntityAttack::
   022D DD E5         [15]  449 	push	ix
   022F DD 21 00 00   [14]  450 	ld	ix,#0
   0233 DD 39         [15]  451 	add	ix,sp
                            452 ;src/entity.c:92: PrintAt (STATUS_X,STATUS_Y, e->name, PEN_BRIGHT);
   0235 DD 5E 04      [19]  453 	ld	e,4 (ix)
   0238 DD 56 05      [19]  454 	ld	d,5 (ix)
   023B 21 06 00      [10]  455 	ld	hl, #0x0006
   023E 19            [11]  456 	add	hl, de
   023F D5            [11]  457 	push	de
   0240 3E 02         [ 7]  458 	ld	a, #0x02
   0242 F5            [11]  459 	push	af
   0243 33            [ 6]  460 	inc	sp
   0244 E5            [11]  461 	push	hl
   0245 21 02 15      [10]  462 	ld	hl, #0x1502
   0248 E5            [11]  463 	push	hl
   0249 CDr00r00      [17]  464 	call	_PrintAt
   024C F1            [10]  465 	pop	af
   024D F1            [10]  466 	pop	af
   024E 33            [ 6]  467 	inc	sp
   024F 3E 03         [ 7]  468 	ld	a, #0x03
   0251 F5            [11]  469 	push	af
   0252 33            [ 6]  470 	inc	sp
   0253 21r8Er02      [10]  471 	ld	hl, #___str_2
   0256 E5            [11]  472 	push	hl
   0257 21 0A 15      [10]  473 	ld	hl, #0x150a
   025A E5            [11]  474 	push	hl
   025B CDr00r00      [17]  475 	call	_PrintAt
   025E F1            [10]  476 	pop	af
   025F F1            [10]  477 	pop	af
   0260 33            [ 6]  478 	inc	sp
   0261 D1            [10]  479 	pop	de
                            480 ;src/entity.c:94: PrintAt (STATUS_X+16,STATUS_Y, target->name, PEN_BRIGHT);
   0262 DD 4E 06      [19]  481 	ld	c,6 (ix)
   0265 DD 46 07      [19]  482 	ld	b,7 (ix)
   0268 21 06 00      [10]  483 	ld	hl, #0x0006
   026B 09            [11]  484 	add	hl, bc
   026C C5            [11]  485 	push	bc
   026D D5            [11]  486 	push	de
   026E 3E 02         [ 7]  487 	ld	a, #0x02
   0270 F5            [11]  488 	push	af
   0271 33            [ 6]  489 	inc	sp
   0272 E5            [11]  490 	push	hl
   0273 21 12 15      [10]  491 	ld	hl, #0x1512
   0276 E5            [11]  492 	push	hl
   0277 CDr00r00      [17]  493 	call	_PrintAt
   027A F1            [10]  494 	pop	af
   027B F1            [10]  495 	pop	af
   027C 33            [ 6]  496 	inc	sp
   027D CDr5Fr01      [17]  497 	call	_EntityCalculateDamage
   0280 F1            [10]  498 	pop	af
   0281 55            [ 4]  499 	ld	d, l
   0282 C1            [10]  500 	pop	bc
                            501 ;src/entity.c:97: EntityTakeDamage (target, dmg);
   0283 D5            [11]  502 	push	de
   0284 33            [ 6]  503 	inc	sp
   0285 C5            [11]  504 	push	bc
   0286 CDr98r01      [17]  505 	call	_EntityTakeDamage
   0289 F1            [10]  506 	pop	af
   028A 33            [ 6]  507 	inc	sp
   028B DD E1         [14]  508 	pop	ix
   028D C9            [10]  509 	ret
   028E                     510 ___str_2:
   028E 61 74 74 61 63 6B   511 	.ascii "attacks"
        73
   0295 00                  512 	.db 0x00
                            513 ;src/entity.c:102: u8 GetBlockingEntity (TEntity *entities[], TEntity **out_e, u8 x, u8 y)
                            514 ;	---------------------------------
                            515 ; Function GetBlockingEntity
                            516 ; ---------------------------------
   0296                     517 _GetBlockingEntity::
   0296 DD E5         [15]  518 	push	ix
   0298 DD 21 00 00   [14]  519 	ld	ix,#0
   029C DD 39         [15]  520 	add	ix,sp
   029E F5            [11]  521 	push	af
                            522 ;src/entity.c:107: while ( (e=*entities++) != NULL) {
   029F DD 4E 04      [19]  523 	ld	c,4 (ix)
   02A2 DD 46 05      [19]  524 	ld	b,5 (ix)
   02A5                     525 00105$:
   02A5 69            [ 4]  526 	ld	l, c
   02A6 60            [ 4]  527 	ld	h, b
   02A7 5E            [ 7]  528 	ld	e, (hl)
   02A8 23            [ 6]  529 	inc	hl
   02A9 56            [ 7]  530 	ld	d, (hl)
   02AA 03            [ 6]  531 	inc	bc
   02AB 03            [ 6]  532 	inc	bc
   02AC 33            [ 6]  533 	inc	sp
   02AD 33            [ 6]  534 	inc	sp
   02AE D5            [11]  535 	push	de
   02AF 7A            [ 4]  536 	ld	a, d
   02B0 B3            [ 4]  537 	or	a,e
   02B1 28 2E         [12]  538 	jr	Z,00107$
                            539 ;src/entity.c:108: if (e->blocks && e->x == x && e->y == y) {
   02B3 E1            [10]  540 	pop	hl
   02B4 E5            [11]  541 	push	hl
   02B5 11 15 00      [10]  542 	ld	de, #0x0015
   02B8 19            [11]  543 	add	hl, de
   02B9 7E            [ 7]  544 	ld	a, (hl)
   02BA B7            [ 4]  545 	or	a, a
   02BB 28 E8         [12]  546 	jr	Z,00105$
   02BD E1            [10]  547 	pop	hl
   02BE E5            [11]  548 	push	hl
   02BF DD 7E 08      [19]  549 	ld	a,8 (ix)
   02C2 96            [ 7]  550 	sub	a,(hl)
   02C3 20 E0         [12]  551 	jr	NZ,00105$
   02C5 E1            [10]  552 	pop	hl
   02C6 E5            [11]  553 	push	hl
   02C7 23            [ 6]  554 	inc	hl
   02C8 DD 7E 09      [19]  555 	ld	a,9 (ix)
   02CB 96            [ 7]  556 	sub	a,(hl)
   02CC 20 D7         [12]  557 	jr	NZ,00105$
                            558 ;src/entity.c:109: *out_e = e;
   02CE DD 4E 06      [19]  559 	ld	c,6 (ix)
   02D1 DD 46 07      [19]  560 	ld	b,7 (ix)
   02D4 DD 7E FE      [19]  561 	ld	a, -2 (ix)
   02D7 02            [ 7]  562 	ld	(bc), a
   02D8 03            [ 6]  563 	inc	bc
   02D9 DD 7E FF      [19]  564 	ld	a, -1 (ix)
   02DC 02            [ 7]  565 	ld	(bc), a
                            566 ;src/entity.c:110: return TRUE;
   02DD 2E 01         [ 7]  567 	ld	l, #0x01
   02DF 18 02         [12]  568 	jr	00108$
   02E1                     569 00107$:
                            570 ;src/entity.c:113: return FALSE;
   02E1 2E 00         [ 7]  571 	ld	l, #0x00
   02E3                     572 00108$:
   02E3 DD F9         [10]  573 	ld	sp, ix
   02E5 DD E1         [14]  574 	pop	ix
   02E7 C9            [10]  575 	ret
                            576 ;src/entity.c:118: void EntityDrawEntities (TEntity *entities[], u8 dirty[])
                            577 ;	---------------------------------
                            578 ; Function EntityDrawEntities
                            579 ; ---------------------------------
   02E8                     580 _EntityDrawEntities::
   02E8 DD E5         [15]  581 	push	ix
   02EA DD 21 00 00   [14]  582 	ld	ix,#0
   02EE DD 39         [15]  583 	add	ix,sp
   02F0 F5            [11]  584 	push	af
                            585 ;src/entity.c:122: while ( (e=entities[i]) ) {
   02F1 0E 00         [ 7]  586 	ld	c, #0x00
   02F3                     587 00103$:
   02F3 69            [ 4]  588 	ld	l, c
   02F4 26 00         [ 7]  589 	ld	h, #0x00
   02F6 29            [11]  590 	add	hl, hl
   02F7 EB            [ 4]  591 	ex	de,hl
   02F8 DD 6E 04      [19]  592 	ld	l,4 (ix)
   02FB DD 66 05      [19]  593 	ld	h,5 (ix)
   02FE 19            [11]  594 	add	hl, de
   02FF 5E            [ 7]  595 	ld	e, (hl)
   0300 23            [ 6]  596 	inc	hl
   0301 56            [ 7]  597 	ld	d, (hl)
   0302 33            [ 6]  598 	inc	sp
   0303 33            [ 6]  599 	inc	sp
   0304 D5            [11]  600 	push	de
   0305 7A            [ 4]  601 	ld	a, d
   0306 B3            [ 4]  602 	or	a,e
   0307 28 37         [12]  603 	jr	Z,00106$
                            604 ;src/entity.c:123: if (dirty[i]) {
   0309 DD 6E 06      [19]  605 	ld	l,6 (ix)
   030C DD 66 07      [19]  606 	ld	h,7 (ix)
   030F 06 00         [ 7]  607 	ld	b, #0x00
   0311 09            [11]  608 	add	hl, bc
   0312 7E            [ 7]  609 	ld	a, (hl)
   0313 B7            [ 4]  610 	or	a, a
   0314 28 16         [12]  611 	jr	Z,00102$
                            612 ;src/entity.c:124: EntityDraw (e, TRUE);
   0316 E5            [11]  613 	push	hl
   0317 C5            [11]  614 	push	bc
   0318 3E 01         [ 7]  615 	ld	a, #0x01
   031A F5            [11]  616 	push	af
   031B 33            [ 6]  617 	inc	sp
   031C DD 5E FE      [19]  618 	ld	e,-2 (ix)
   031F DD 56 FF      [19]  619 	ld	d,-1 (ix)
   0322 D5            [11]  620 	push	de
   0323 CDrCBr00      [17]  621 	call	_EntityDraw
   0326 F1            [10]  622 	pop	af
   0327 33            [ 6]  623 	inc	sp
   0328 C1            [10]  624 	pop	bc
   0329 E1            [10]  625 	pop	hl
                            626 ;src/entity.c:125: dirty[i] = FALSE;
   032A 36 00         [10]  627 	ld	(hl), #0x00
   032C                     628 00102$:
                            629 ;src/entity.c:127: EntityDraw (e, FALSE);
   032C C5            [11]  630 	push	bc
   032D AF            [ 4]  631 	xor	a, a
   032E F5            [11]  632 	push	af
   032F 33            [ 6]  633 	inc	sp
   0330 DD 6E FE      [19]  634 	ld	l,-2 (ix)
   0333 DD 66 FF      [19]  635 	ld	h,-1 (ix)
   0336 E5            [11]  636 	push	hl
   0337 CDrCBr00      [17]  637 	call	_EntityDraw
   033A F1            [10]  638 	pop	af
   033B 33            [ 6]  639 	inc	sp
   033C C1            [10]  640 	pop	bc
                            641 ;src/entity.c:128: ++i;
   033D 0C            [ 4]  642 	inc	c
   033E 18 B3         [12]  643 	jr	00103$
   0340                     644 00106$:
   0340 DD F9         [10]  645 	ld	sp, ix
   0342 DD E1         [14]  646 	pop	ix
   0344 C9            [10]  647 	ret
                            648 	.area _CODE
                            649 	.area _INITIALIZER
                            650 	.area _CABS (ABS)
